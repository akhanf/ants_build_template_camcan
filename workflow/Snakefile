from os.path import join
import itertools
import pandas as pd

configfile: 'config/config.yml'


#load participants.tsv file, and strip off sub- from participant_id column
df = pd.read_table(config['participants_tsv'])
subjects = df.participant_id.to_list() 
subjects = [ s.strip('sub-') for s in subjects ]

#get channels using keys in in_images
channels = list(config['in_images'].keys())

#need this to make sure iterations don't go below 0!
wildcard_constraints:
    iteration="[0-9]+"


if config['enable_quick_dirty'] == True:
    config['ants'] = config['ants_quick_dirty']


localrules: all, gen_init_avg_template, get_existing_template, set_init_template


rule all:
    input:
        avg_template =  expand('results/iter_{iteration}/template_{{channel}}.nii.gz'.format(iteration=config['max_iters']),channel=channels),


include: 'rules/common.smk'
include: 'rules/reg_t2_to_t1.smk'
include: 'rules/ants_template.smk'
include: 'rules/templateflow.smk'


